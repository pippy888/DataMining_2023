2023-12-30 22:40:35,115 - INFO - Log directory: ./libcity/log
2023-12-30 22:40:35,115 - INFO - Begin pretrain-pipeline, task=trajectory_embedding, model_name=BERTContrastiveLM, dataset_name=bj, exp_id=268077
2023-12-30 22:40:35,115 - INFO - {'task': 'trajectory_embedding', 'model': 'BERTContrastiveLM', 'dataset': 'bj', 'saved_model': True, 'train': True, 'gpu': True, 'gpu_id': 0, 'distribution': 'geometric', 'avg_mask_len': 2, 'contra_ratio': 0.4, 'mlm_ratio': 0.6, 'split': True, 'n_layers': 6, 'd_model': 256, 'attn_heads': 8, 'max_epoch': 30, 'batch_size': 64, 'grad_accmu_steps': 1, 'learning_rate': 0.0002, 'roadnetwork': 'bj_roadmap_edge_bj_True_1_merge', 'geo_file': 'bj_roadmap_edge_bj_True_1_merge_withdegree', 'rel_file': 'bj_roadmap_edge_bj_True_1_merge_withdegree', 'merge': True, 'min_freq': 1, 'seq_len': 128, 'test_every': 50, 'temperature': 0.05, 'contra_loss_type': 'simclr', 'classify_label': 'vflag', 'type_ln': 'post', 'add_cls': True, 'add_time_in_day': True, 'add_day_in_week': True, 'add_pe': True, 'add_temporal_bias': True, 'temporal_bias_dim': 64, 'use_mins_interval': False, 'add_gat': True, 'gat_heads_per_layer': [8, 16, 1], 'gat_features_per_layer': [16, 16, 256], 'gat_dropout': 0.1, 'gat_K': 1, 'gat_avg_last': True, 'load_trans_prob': True, 'append_degree2gcn': True, 'normal_feature': False, 'pooling': 'cls', 'dataset_class': 'ContrastiveSplitLMDataset', 'executor': 'ContrastiveSplitMLMExecutor', 'evaluator': 'ClassificationEvaluator', 'num_workers': 0, 'vocab_path': None, 'masking_ratio': 0.15, 'masking_mode': 'together', 'mlp_ratio': 4, 'pretrain_road_emb': None, 'future_mask': False, 'load_node2vec': False, 'dropout': 0.1, 'drop_path': 0.3, 'attn_drop': 0.1, 'seed': 0, 'learner': 'adamw', 'lr_eta_min': 0, 'lr_warmup_epoch': 4, 'lr_warmup_init': 1e-06, 'lr_decay': True, 'lr_scheduler': 'cosinelr', 'lr_decay_ratio': 0.1, 't_in_epochs': True, 'clip_grad_norm': True, 'max_grad_norm': 5, 'use_early_stop': True, 'patience': 10, 'log_batch': 500, 'log_every': 1, 'l2_reg': None, 'n_views': 2, 'similarity': 'cosine', 'data_argument1': [], 'data_argument2': [], 'cutoff_row_rate': 0.2, 'cutoff_column_rate': 0.2, 'cutoff_random_rate': 0.2, 'sample_rate': 0.2, 'align_w': 1.0, 'unif_w': 1.0, 'align_alpha': 2, 'unif_t': 2, 'train_align_uniform': False, 'test_align_uniform': True, 'norm_align_uniform': False, 'bidir_adj_mx': False, 'out_data_argument1': None, 'out_data_argument2': None, 'metrics': ['Precision', 'Recall', 'F1', 'MRR', 'NDCG'], 'save_modes': ['csv', 'json'], 'topk': [1, 5, 10], 'device': device(type='cuda', index=0), 'exp_id': 268077}
2023-12-30 22:40:35,615 - INFO - Loading Vocab from raw_data/vocab_bj_True_1_merge.pkl
2023-12-30 22:40:35,615 - INFO - vocab_path=raw_data/vocab_bj_True_1_merge.pkl, usr_num=36, vocab_size=24094
2023-12-30 22:40:35,662 - INFO - Loaded file bj_roadmap_edge_bj_True_1_merge_withdegree.geo, num_nodes=24090
2023-12-30 22:40:36,754 - INFO - Loaded file bj_roadmap_edge_bj_True_1_merge_withdegree.rel, shape=(24090, 24090), edges=45975.0
2023-12-30 22:40:36,770 - INFO - node_features: (24090, 42)
2023-12-30 22:40:37,693 - INFO - node_features_encoded: torch.Size([24094, 42])
2023-12-30 22:40:37,823 - INFO - edge_index: torch.Size([2, 70065])
2023-12-30 22:40:37,823 - INFO - Trajectory loc-transfer prob shape=torch.Size([70065, 1])
2023-12-30 22:40:37,823 - INFO - Loading Dataset!
2023-12-30 22:40:37,917 - INFO - Load dataset from raw_data/bj/cache_bj_train_True_True_1.pkl
2023-12-30 22:40:37,917 - INFO - Init TrajectoryProcessingDatasetSplitLM!
2023-12-30 22:40:38,105 - INFO - Load dataset from raw_data/bj/cache_bj_train_True_True_1.pkl, raw_data/bj/cache_bj_train_True_True_1.pkl
2023-12-30 22:40:38,136 - INFO - Load dataset from raw_data/bj/cache_bj_eval_True_True_1.pkl
2023-12-30 22:40:38,136 - INFO - Init TrajectoryProcessingDatasetSplitLM!
2023-12-30 22:40:38,199 - INFO - Load dataset from raw_data/bj/cache_bj_eval_True_True_1.pkl, raw_data/bj/cache_bj_eval_True_True_1.pkl
2023-12-30 22:40:38,214 - INFO - Load dataset from raw_data/bj/cache_bj_test_True_True_1.pkl
2023-12-30 22:40:38,214 - INFO - Init TrajectoryProcessingDatasetSplitLM!
2023-12-30 22:40:38,277 - INFO - Load dataset from raw_data/bj/cache_bj_test_True_True_1.pkl, raw_data/bj/cache_bj_test_True_True_1.pkl
2023-12-30 22:40:38,277 - INFO - Size of dataset: 5778/1926/1927
2023-12-30 22:40:38,277 - INFO - Creating Dataloader!
2023-12-30 22:40:38,277 - INFO - Building BERTContrastiveLM model
2023-12-30 22:40:38,355 - INFO - Building BERTPooler model
